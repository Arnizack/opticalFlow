#include"cpu_backend/flow/inner/LogOcclusion.h"
#include"gtest/gtest.h"


namespace cpu_backend
{
	TEST(OcclusionTest, test1)
	{
		double divergence[35] =
		{
			0.00024414, -0.00238051, -0.01184564, -0.02164232, -0.02572867,  0.00264531, 0.01084783,
			0.0177849, -0.00130405, -0.00890412, -0.01502099, -0.01863904,  0.00240205, 0.01437021,
			0.02051796,  0.01915272,  0.00578636,  0.01003546, -0.02535819, -0.02759867, 0.00820716,
			0.00310572,  0.01777156,  0.00087959, -0.01111114, -0.06505459, -0.05306761, 0.00435892,
			0.00481468,  0.01587543,  0.01102415, -0.02574996, -0.05790381, -0.03461482, 0.00334843
		};

		double actual_log_occlusion[35];
		float image[70] = { 0 };
		ComputeLogOcclusion(actual_log_occlusion, image, image, divergence, 7, 5, 3,0.3,20.0);
		double expected_log_occlusion[35] =
		{
			-0.00000000e+00, - 3.14823326e-05, - 7.79550975e-04, - 2.60216600e-03, - 3.67758015e-03, - 0.00000000e+00, - 0.00000000e+00,
			-0.00000000e+00, - 9.44754929e-06, - 4.40463536e-04, - 1.25350107e-03, - 1.93007737e-03, - 0.00000000e+00, - 0.00000000e+00,
			-0.00000000e+00, - 0.00000000e+00, - 0.00000000e+00, - 0.00000000e+00, - 3.57243125e-03, - 4.23159327e-03, - 0.00000000e+00,
			-0.00000000e+00, - 0.00000000e+00, - 0.00000000e+00, - 6.85874295e-04, - 2.35116652e-02, - 1.56453934e-02, - 0.00000000e+00,
			-0.00000000e+00, - 0.00000000e+00, - 0.00000000e+00, - 3.68366779e-03, - 1.86269518e-02, - 6.65658764e-03, - 0.00000000e+00
		};

		for (int i = 0; i < 35; i++)
		{
			if (abs(actual_log_occlusion[i] - expected_log_occlusion[i]) > 0.0001)
			{
				printf("Diff\n");
			}
			EXPECT_NEAR(actual_log_occlusion[i], expected_log_occlusion[i],0.0001);
	
		}
	}
}